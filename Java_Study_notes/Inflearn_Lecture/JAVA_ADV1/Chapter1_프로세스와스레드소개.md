# 📚 Chapter 1: 프로세스와 스레드 소개

> 📌 공부 날짜: 2025/04/07
> - `JAVA `- 고급1편
> - `Reference`: 인프런 - 김영한의 실전 자바

---

## ✅ 멀티 태스킹과 멀티 프로세싱
    - 프로그램의 실행이란 프로그램을 구성하는 코드를 순서대로 CPU에서 연산(실행)하는 일.

### 📚 멀티 태스킹 (Multitasking)
- 현대의 CPU는 초당 수십억 번 이상의 연산을 수행한다.
- 각 프로그램의 실행 시간을 분할해서 마치 동시에 실행되는 것처럼 하는 기법을 `시분할(Time sharing, 시간 공유)` 기법이라 한다.
  - 이런 방식을 사용하면 CPU 코어가 하나만 있어도 여러 프로그램이 동시에 실행되는 것처럼 느낄 수 있다.
- **이렇게 하나의 컴퓨터 시스템이 동시에 여러 작업을 수행하는 능력을 `멀티태스킹`이라고 한다.**
    
> 🔍 참고
> - CPU에 어떤 프로그램이 얼마만큼 실행될지는 운영체제가 결정하는데 이것을 `스케줄링(Scheduling)`
> - 이때 단순히 시간으로만 분할하지 않고, CPU를 최대한 활용할 수  있는 다양한 우선순위와 최적화 기법을 사용한다.
> - 우리는 운영체제가 스케줄링을 수행하고, CPU를 최대한 사용하면 작업이 골고루 수행될 수 있게 최적화한다는 정도로 이해하면 충분하다.

### 📚 멀티 프로세싱 (Multiprocessing)
- CPU 안에는 연산을 처리할 수 있는 코어가 있다. 하나의 CPU 안에 보통 2개 이상의 코어가 있다.
- 멀티 프로세싱은 컴퓨터 시스템에서 둘 이상의 프로세서(CPU 코어)를 사용하여 여러 작업을 동시에 처리하는 기술을 의미한다.

> 🤔 멀티 태스킹 vs 멀티 프로세싱
> - 멀티 태스킹은 운영체제 소프트웨어의 관점이고, 멀티 프로세싱은 하드웨어 장비의 관점이다.

---

## ✅ 프로세스와 스레드
### 📚 프로세스
- 프로세스는 실행중인 프로그램의 인스턴스이다.
- 각 프로세스는 독립적인 메모리 공간을 갖고 있으며, 운영체제에서 별도의 작업 단위로 분리해서 관리된다.
- 프로세스가 서로 간섭하지 않고, 서로의 메모리에 직접 접근할 수 있다. 그래서 하나의 프로세스가 충돌해도 다른 프로세스에 영향을 미치지 않는다.

#### 📚📚 프로세스의 메모리 구성
- 코드 섹션: 실행할 프로그램의 코드가 저장되는 부분.
- 데이터 섹션: 전역 변수 및 정적 변수가 저장되는 부분.
- 힙(Heap): 동적으로 할당되는 메모리 영역.
- 스택(Stack): 메서드(함수) 호출 시 생성되는 지역 변수와 반환 주소가 저장되는 영역.

> 🔍 프로세스의 역할
> - 프로세스는 실행 환경을 제공한다.
> - 여기에는 메모리 공간, 파일 핸들, 시스템 자원(네트워크 연결) 등이 포함된다.
> - 이는 프로세스가 컨테이너 역할을 한다는 의미이다.

### 📚 스레드 (Thread)
- 프로세스는 하나 이상의 스레드를 가진다.
- 스레드는 프로세스 내에서 실행되는 작업의 단위이다.
  - 한 프로세스 내에서 하나의 스레드 혹은 여러 스레드가 존재할 수 있으며, 이들은 프로세스가 제공하는 동일한 메모리 공간을 공유한다.
- 스레드는 프로세스보다 단순하므로 생성 및 관리가 단순하고 가볍다.

#### 📚📚 스레드 메모리 구성
- 공유 메모리: 같은 프로세스의 코드 섹션, 데이터 섹션, 힙은 프로세스 안의 모든 스레드와 공유한다.
- 개별 스택: 각 스레드는 자신의 스택을 가지고 있다.

> - 단일 스레드: 한 프로세스 내에 하나의 스레드만 존재.
> - 멀티 스레드: 한 프로세스 내에 여러 스레드가 존재.

#### 📚📚 멀티 스레드가 필요한 이유
- 하나의 프로그램도 그 안에서 동시에 여러 작업이 필요하다.
    - ex) 워드 프로그램에서 문서를 편집하면서, 문서가 자동으로 저장되고, 맞춤법 검사를 함께 수행한다.

---

## ✅ 스레드와 스케줄링
- 운영체제 내부에 스케줄링 큐를 가지고 있으며, 각각의 스레드는 스케줄링 큐에서 대기한다.

> 🔍 컨텍스트 스위칭 (Context Switching)
> - 멀티 태스킹이 반드시 효울적인 것만은 아니다.
>   - 스레드 A, B가 있고, 스레드 A를 먼저 실행하는데 멀티 태스킹 때문에 스레드 A만 실행할 수 없어서 잠시 멈추고 스레드 B를 실행해야 한다.(하나의 코어, 스레드 2개)
>   - 이후에 스레드 A로 그냥 돌아갈 수 없다. CPU에서 스레드를 실행하는데, 스레드 A의 코드가 어디까지 수행되었는지 위치를 찾아야 한다.
>   - 그리고 계산하던 변수들의 값을 CPU에 다시 불러들여야 한다.
> - 이런 과정을 `컨텍스트 스위칭`이라고 한다.
> - 현재 작업하는 문맥이 변하기 때문에 컨텍스트 스위칭이다.
> - 컨텍스트 스위칭 과정에서 이전에 실행 중인 값을 메모리에 잠깐 저장하고, 이후에 다시 실행하는 시점에 저장한 값을 CPU에 다시 불러와야 한다.
> - 컨텍스트 스위칭 과정에는 약간의 비용이 발생한다.
> - **실제로는 컨텍스트 스위칭에 걸리는 시간은 매우 짧다. 하지만 스레드가 매우 많다면 이 비용이 커질 수 있다.** 

---

## ✅ 참고 - 실무 이야기
### 📚 CPU 바운드 작업 vs I/O 바운드 작업
  - 각각의 스레드가 하는 작업을 크게 2가지로 나뉠 수 있다.

1. CPU 바운드 작업 (CPU - bound tasks)
    - CPU의 연산 능력을 많이 요구하는 작업.
    - 이러한 작업은 주로 계산, 데이터 처리, 알고리즘 실행 등 CPU 처리 속도가 작업 완료 시간을 결정하는 경우다.
    - ex) 복잡한 수학 연산, 데이터 분석, 비디오 인코딩 등.

2. I/O 바운드 작업 (Input/Output - bound tasks)
    - 디스크, 네트워크, 파일 시스템 등과 같은 입출력(I/O) 작업을 많이 요구하는 작업을 의미한다.
    - 이러한 작업은 I/O 작업이 완료될 때까지 대기 시간이 많이 발생되며, CPU는 상대적으로 유휴(대기)상태에 있는 경우가 많다.
    - 스레드가 CPU를 사용하지 않고, I/O 작업이 완료될 때까지 대기한다.
    - ex) 데이터베이스 쿼리 처리, 파일 읽기/쓰기, 네트워크 통신, 사용자 입력 처리 등.

### 📚 웹 애플리케이션 서버
- 분야마다 다르겠지만 CPU-바운드 작업보다 I/O-바운드 작업이 많다.
- **스레드의 숫자는 CPU-바운드 작업이 많은가, 아니면 I/O 바운드 작업이 많은가에 따라 다르게 설정해야 한다.**

1. CPU - 바운드 작업이 많을 시: CPU 코어 수 + 1개 = 스레드
    - CPU를 거의 100% 사용하는 작업이므로 스레드를 CPU 수에 최적화.

2. I/O - 바운드 작업이 많을 시: CPU 코어 수보다 많은 스레드를 생성. CPU를 최대한 사용할 수 있는 숫자까지 스레드 생성.
    - CPU를 많이 사용하지 않으므로 성능 테스트를 통해 CPU를 최대한 활용하는 숫자까지 스레드 생성.
    - 단, 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용도 증가하므로 적절한 성능테스트 필요.

---