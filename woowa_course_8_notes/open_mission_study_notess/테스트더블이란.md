# 📖 지식 정리 (우테코를 하며 학습한 내용)
## 1️⃣ 테스트 더블(Test Doubles)이란?
테스트 더블은 소프트웨어 개발 과정에서 사용되는 테스트 방법론 중 하나이다.

즉, **테스트 중인 시스템의 일부분이 완전히 준비되지 않았거나 테스트하기 어려운 상황에서 그 대안으로 사용될 수 있는 `가짜` 컴포넌트를 의미**한다.

테스트 더블은 실제 객체의 행동을 모방하여, 테스트가 특정 조건과 상호작용을 쉽게 재현하고 검증할 수 있도록 한다.

테스트 더블의 종류는 크게 `더미 객체(Dummy Objects)`, `가짜 객체(Fake Objects)`, `스텀(Stubs)`, `스파이(Spies)`, `목(Mock)` 등으로 나눌 수 있으며,
각각 테스트의 다른 측면을 지원한다.

---

### 🤔 **왜 테스트 더블을 사용할까?**
1. **실제 객체가 아직 개발되지 않았거나 접근이 불가능한 경우에 대한 테스트를 가능하게 한다.**
- 이는 특히 큰 시스템이나 마이크로서비스 아키텍처에서 한 컴포넌트를 독립적으로 테스트하고 싶을 때 중요하다.

2. **테스트 더블을 사용하면 복잡한 환경이나 시나리오를 간단하게 모의할 수 있다.**
- 예를 들어, 네트워크 오류, 서버 다운, 응답 지연 등의 상황을 재현하여 테스트 코드가 이러한 상황을 적절히 처리하는지 확인할 수 있다.

3. **테스트 실행 속도를 크게 향상시킬 수 있다.**
- 실제 데이터베이스나 외부 서비스와의 상호작용 없이 테스트 더블을 사용하면, 테스트 실행에 걸리는 시간을 단축시키고 개발 과정을 더 민첩하게 만든다.

4. **테스트의 독립성을 보장한다.**
- 테스트 더블을 사용하면 외부 시스템의 상태나 동작에 의존하지 않으므로, 어떤 외부 환경 변화에도 테스트 결과의 일관성을 유지할 수 있다.

> 결국 **테스트 더블은 테스트가 더욱 예측 가능하고, 신뢰할 수 있으며, 유지보수가 용이하도록 만드는 중요한 도구이다.**
> 개발자는 테스트 더블을 적극 활용하여, 품질 높은 소프트웨어를 더 빠르고 효과적으로 개발할 수 있다.

---

### 테스트 더블의 종류
> **Dummy**
> - 이들은 실제로는 사용되지 않지만, 파라미터 리스트를 채우기 위해 필요한 객체들이다.
> - 그들은 단지 인터페이스를 충족시키는 데 사용되며, 실제 작동하지는 않는다.

> **Fake**
> - Fake 객체들은 실제 객체의 간단한 버전으로,
>   - 예를 들어, 가벼운 데이터베이스 서버나 간단한 로직을 가진 컴포넌트로 작동할 수 있다.
>   - Fakes는 실제 동작을 가지지만, 테스트를 위해 설계된 간소화된 코드이다.

> **Stubs**
> - Stubs는 테스트 중에 호출되면 미리 준비된 응답을 제공한다.
>   - 예를 들어, 특정 메소드 호출에 대한 반환 값을 설정할 수 있으며, 외부 서비스나 컴포넌트를 대체하는데 사용된다.

> **Spies**
> - Spies는 Stubs와 유사하지만, 호출되었을 때의 정보를 기록한다.
> - 그래서 테스트에서 그 기록을 검사할 수 있어서 어떤 함수가 어떻게 호출되었는지, 몇 번 호출되었는지 등을 확인할 수 있다.

> **Mocks**
> - Mocks는 Spies와 비슷하지만 더 엄격하다.
> - Mocks는 예상된 호출의 명세(specification)를 정의하며, 테스트에서 이 명세가 충족되지 않으면 테스트가 실패한다.
> - 이를 통해 객체 간의 상호작용을 정확히 검증할 수 있다.

각각의 테스트 더블 유형은 특정 테스트 시나리오에 적합하며, 테스트 목적에 따라 선택되어야 한다.

---

### Stub vs Mock(상태 검증 vs 행위 검증)
Stub와 Mock의 역할이 겹치는 것으로 보인다.
둘 다 실제 객체 대신 테스트 객체로 동작할 수 있으며 내부 행위에 대해 개발자가 관리할 수 있다.

그러나 둘은 사용하기 위한 역할이 다르기 때문에 주의해서 사용해야 한다.
그리고 역할의 차이를 알기 위해선 `상태 검증`과 행위 검증이라는 개념을 알아야 한다.

> **상태 검증 (State Verification)**
> - 상태 검증은 코드가 특정 작업을 수행한 후에 시스템의 상태가 예상대로 변경되었는지를 확인한다.
>   - 예를 들어, 물건을 장바구니에 추가하는 기능을 테스트한다면, 상태 검증은 실제로 장바구니에 해당 물건이 추가되었는지를 검사
> - 이 방식은 객체의 상태가 올바르게 유지되고 변화하는지 확인하는데 주로 사용된다.

> **행위 검증 (Behavior Verification)**
> - 행위 검증은 시스템의 상태보다는 특정 작업을 수행하는 과정에서 발생하는 행위에 더 관심을 둔다.
> - 이는 객체가 예상대로 다른 객체와 상호작용(예: 메서드 호출)하는지를 검증하는데 사용된다.
> - Mock 객체가 주로 이 방식으로 사용됨.
>   - 예를 들어, 메시지를 보내는 기능을 테스트할 때, 실제로 메시지가 전송되었는지를 확인하기보다는
>   - 메시지 서비스의 send 메서드가 적절한 매개변수와 함께 호출되었는지를 검증한다.

> **Mock과 Stub의 역할 차이**
> - `Mock Objects`는 주로 **행위 검증에 사용**된다.
> - Mock 객체를 사용하는 테스트는 대상 코드가 다른 컴포넌트와 예상대로 상호작용하는지를 검증한다.
>   - 예를 들어, 어떤 서비스의 메서드가 호출되었는지, 특정 이벤트가 발생했는지 등의 상호작용을 검사한다.
> - `Stub Objects`는 **상태 검증에 더 자주 사용**된다.
> - Stub는 예상된 결과를 반환하거나 특정 상태를 시뮬레이션하여 대상 코드가 이 상태를 기반으로 올바르게 작동하는지 확인할 수 있도록 한다.

상태 검증과 행위 검증은 서로 보완적이며, 때로는 동일한 테스트 케이스 내에서 함께 사용될 수 있다.
예를 들어, 특정 메소드의 호출 결과로 객체의 상태가 변경되었는지 확인하는 경우에는 둘 다 사용된다.

이 두 방법을 이해하고 적절히 활용하면, 보다 견고하고 신뢰할 수 있는 소프트웨어 테스트를 구현할 수 있다.

---

### 🚨 주의해야 할 점
- 과도한 모킹 주의
- 현실성 있는 테스트 데이터 사용
- 테스트 유지보수 고려

---

## ☑️ 고민한 내용
- 객체를 어떻게 테스트해야 할지 고민하던 중 **테스트 더블(Test Double)** 개념을 알게 되었고, 이를 계기로 테스트 기법 전반을 공부하게 되었다.

- 아직 직접 활용하기에는 난도가 높게 느껴지지만, 다양한 테스트 방식이 존재한다는 것을 알게 된 점이 큰 수확이었다.

- 처음으로 테스트 코드를 작성하는 단계라 익숙함이 부족하지만, 점점 경험이 쌓이면 테스트 더블을 포함한 여러 기법을 활용해 **더 안정적이고 신뢰도 높은 테스트 코드**를 작성해보고 싶다.

---

## 🔖 References
- [테스트 더블(Test Doubles)](http://velog.io/@carrykim/%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8D%94%EB%B8%94Test-Doubles)

---
